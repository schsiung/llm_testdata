"use strict";var BMS=BMS||{};BMS.FUNCTIONS={calculateDiscount:function(t,e=null){return""===e||null===e||"null"===e||0===e?parseFloat(Number(t)):"string"==typeof e&&e.indexOf("%")>0?parseFloat(Number(t)-Number(e.replace("%",""))/100*Number(t)):parseFloat(Number(t)-Number(e))},calculateTarifCharges:function(t,e=null){return""===e||null===e||"null"===e||0===e?0:"string"==typeof e&&e.indexOf("%")>0?(Number(e.replace("%",""))/100*Number(t)).toFixed(2):Number(e).toFixed(2)},datePicker:function({selector:t=".datePicker",format:e="YYYY-MM-DD",timePicker:a=!1}=""){$(t).daterangepicker({autoUpdateInput:!1,singleDatePicker:!0,showDropdowns:!0,timePicker:a,timePicker24Hour:!0,autoApply:!0,parentEl:"div.dynamic-container",drops:"auto",locale:{format:e,cancelLabel:"Clear"}}),$(t).on("apply.daterangepicker",(function(t,a){$(this).val(a.startDate.format(e))})),$(t).on("cancel.daterangepicker",(function(t,e){$(this).val("")}))},dateRangePicker:function({selector:t=".dateRangePicker",format:e="YYYY-MM-DD",timePicker:a=!1}=""){$(t).daterangepicker({autoUpdateInput:!1,showDropdowns:!0,drops:"auto",linkedCalendars:!1,timePicker:a,timePicker24Hour:!0,parentEl:"div.dynamic-container",locale:{format:e,cancelLabel:"Clear"}}),$(t).on("apply.daterangepicker",(function(t,a){$(this).val(a.startDate.format(e)+" - "+a.endDate.format(e))})),$(t).on("cancel.daterangepicker",(function(t,e){$(this).val("")}))},dateRangePickerPreDefined:function({selector:t=".dateRangePickerPreDefined",format:e="YYYY-MM-DD",timePicker:a=!1,ranges:o={}}=""){$(t).daterangepicker({autoUpdateInput:!1,showDropdowns:!0,drops:"auto",alwaysShowCalendars:!0,linkedCalendars:!1,timePicker:a,timePicker24Hour:!0,parentEl:"div.dynamic-container",locale:{format:e,cancelLabel:"Clear"},ranges:Object.keys(o).length>0?o:{Today:[moment(),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"This Year":[moment().startOf("year"),moment().endOf("year")],"Last Year":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")],All:[moment(0),moment().subtract("year").endOf("day")]}}),$(t).on("apply.daterangepicker",(function(t,a){$(this).val(a.startDate.format(e)+" - "+a.endDate.format(e))})),$(t).on("cancel.daterangepicker",(function(t,e){$(this).val("")}))},multiDatePicker:function({selector:t=".multiDatePicker",format:e="yyyy-mm-dd"}=""){$(t).datepicker({multidate:!0,multidateSeparator:", ",format:e,todayHighlight:!0})},getCookie:function(t){var e=decodeURIComponent(`; ${document.cookie}`).split(`; ${t}=`);if(e.length>1)return e[1].split("; ")[0]},_n:function(t){let e=BMS.fn.getCookie("lang"),a={bn_BD:"bn-BD"};return void 0!==e?new Intl.NumberFormat(a[e]).format(t):t},createNewSelect2Item:function(t){var e=$(t).attr("select2-create-new-url"),a=$(".select2-search__field").val(),o=encodeURIComponent(a);console.log(t),$("body").trigger("mousedown"),$("#modalDefault").modal("show").find(".modal-content").load(e+"&val="+o),$("#modalDefault").on("hidden.bs.modal",(function(e){BMS.fn.select2(t,"",a)}))},play:function(t,e=!1){var a=`${full_website_address}/assets/sounds/${t}.mp3`,o=new window.Audio(a);$(document).on("pauseAudio",(function(){o.pause()})),o.loop=e,o.play()},pause:function(){$(document).trigger("pauseAudio")},startTimer(t="#timer"){var e=(new Date).getTime();return setInterval((function(){var a=(new Date).getTime()-e,o=Math.floor(a%864e3/36e4).toString().padStart(2,0),r=Math.floor(a%36e4/6e4).toString().padStart(2,0),n=Math.floor(a%6e4/1e3).toString().padStart(2,0);$(t).html(`${o}:${r}:${n}`)}),1e3)},stopTimer:function(t){clearInterval(t)},notify:function(t){Swal.fire({toast:!0,position:"top-right",timer:5e3,timerProgressBar:!0,iconHtml:'<i class="fa fa-bell"></i>',didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer),this.play("beep")},title:`<span style="padding: 10px 0; font-size: 16px;"> ${t} </span>`,showConfirmButton:!1,onClose:$("body").css("padding","0px")})},desktopNotify:function(t,e="",a=""){"granted"!==Notification.permission?Notification.requestPermission():new Notification(t,{icon:e,body:a}).onclick=function(){window.focus(),this.close()}},alertError:function(t){Swal.fire({toast:!0,position:"top-right",icon:"error",timer:5e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer),this.play("warning")},title:`<span style="font-size: 16px;"> ${t} </span>`,showConfirmButton:!1,onClose:$("body").css("padding","0px")})},alertSuccess:function(t,e=!0){Swal.fire({toast:!0,position:"top-right",icon:"success",timer:5e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer),e&&this.play("warning")},title:`<span style="font-size: 16px;"> ${t} </span>`,showConfirmButton:!1,onClose:$("body").css("padding","0px")})},dTable:function(t){var e=JSON.parse(localStorage.getItem("filterItem"));null!==e&&($(t).find("tfoot select").each((function(t,a){e[a.id]&&($("#"+a.id+" option[value='"+e[a.id].value+"']").remove(),$("#"+a.id).append($('<option selected="selected" value="'+e[a.id].value+'">'+e[a.id].text+"</option>")))})),$(t).find("tfoot input, tfoot textarea").each((function(t,a){e[a.id]&&e[a.id].value&&$("#"+a.id).val(e[a.id].value)})));var a="";a=void 0!==$(t).attr("dt-data-url")?$(t).attr("dt-data-url"):DataTableAjaxPostUrl;var o=!0;void 0!==$(t).attr("dt-disable-on-type-search")&&(o=!1);var r=void 0!==$(".defaultOrder").html()?[[$("th.defaultOrder").index(),"desc"]]:[1,"desc"],n="undefined"!=typeof defaultiDisplayLength?defaultiDisplayLength:15,l=void 0!==$(t).attr("dt-height")?$(t).attr("dt-height"):"60vh",s=$(t).DataTable({processing:!0,serverSide:!0,responsive:!1,scrollX:!0,scrollY:l,scrollCollapse:!0,stateSave:!0,search:{return:!0},initComplete:function(t,e){if(o){var a=new $.fn.dataTable.Api(t);$(".dataTables_filter input").unbind(),$(".dataTables_filter input").bind("keyup",(function(t){13==(t.keyCode||t.which)&&a.search(this.value).draw()}))}},stateSaveParams:function(t,e){e.search.search="",e.length=15,e.order=r},order:r,select:{style:"multi+shift",selector:"td:first-child"},language:Object.keys(language).length>0?language:{processing:"<i style='color: #3c8dbc;' class='fa fa-spinner fa-2x fa-spin fa-fw'></i><span style='margin-left: 10px;'>Processing...</span>"},aLengthMenu:[[15,100,500,1500,5e3,-1],[15,100,500,1500,5e3,"All"]],iDisplayLength:n,ajax:{url:a,type:"post"},columnDefs:[{targets:"countTotal",className:"text-right",render:$.fn.dataTable.render.number(",",".",2)},{targets:"highlightWithCountTotal",className:"text-right highlight",render:$.fn.dataTable.render.number(",",".",2)},{targets:"text-right",className:"text-right"},{targets:"sort",orderable:!0,searchable:!0},{targets:"no-sort",orderable:!1},{targets:0,orderable:!1,checkboxes:{selectRow:!0}},{targets:"px120",className:"px120"},{targets:"px160",className:"px160"},{visible:!1,targets:"hideit"},{targets:"dtDescription",className:"dtDescription"},{targets:"highlight",className:"highlight"}],footerCallback:function(t,e,a,o,r){this.api().columns(".countTotal, .highlightWithCountTotal",{page:"current"}).every((function(){var t=this.data().reduce((function(t,e){return(parseFloat(t)||0)+(parseFloat(e)||0)}),0);$(this.footer()).html(t.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))}))}}),i={};s.columns().every((function(){var t=this,e=$("select",this.footer())[0],a=$("textarea, input:not(.notThisValueFilter)",this.footer())[0];e&&(i[e.id]={value:e.value,text:e.options[e.selectedIndex].text}),a&&(i[a.id]={value:a.value}),$("input, select, textarea",this.footer()).on("enter change clear apply.daterangepicker",(function(){var o,r=$(this).closest("th").find(".notThisValueFilter");o=r.length>0&&"!="===$(r).val()&&""!==this.value?JSON.stringify({operator:"!=",search:this.value}):this.value,t.search()!==this.value&&t.search(o).draw(),e&&(i[e.id]={value:e.value,text:e.options[e.selectedIndex].text}),a&&(i[a.id]={value:a.value}),localStorage.setItem("filterItem",JSON.stringify(i))}))}));var c=new Date,d=`${c.getDate()}-${c.getMonth()+1}-${c.getFullYear()} ${c.getHours()}:${c.getMinutes()}:${c.getSeconds()}`;$(".printButtonPosition").length>0&&(new $.fn.dataTable.Buttons(s,{buttons:[{extend:"print",text:'<i class="fa fa-print"></i> <?= __("Print"); ?>',titleAttr:"Print",className:"btn btn-default btn-sm",messageTop:"<b>Printed On:</b> "+d,title:"",footer:!0,autoPrint:!0,exportOptions:{columns:":visible:not(.no-print):not(.dt-checkboxes-cell)",format:{footer:function(t,e,a){return $(a).prop("outerHTML").indexOf("no-print")>0?t.replace(t,""):t}}},messageTop:function(){return void 0!==$("#DtExportTopMessage").html()?$("#DtExportTopMessage").html():"<h2 class='text-center'>"+document.title+"</h2><br/> <p class='text-center'> <strong>Printed On: </strong> "+d+" </p> <br/>"}},{extend:"copy",text:'<i class="fa fa-files-o"></i> <?= __("Copy"); ?>',titleAttr:"Copy",className:"btn btn-default btn-sm",footer:!0,exportOptions:{columns:":visible:not(.no-print):not(.dt-checkboxes-cell)",format:{footer:function(t,e,a){return $(a).prop("outerHTML").indexOf("no-print")>0?t.replace(t,""):t}}}},{extend:"excel",text:'<i class="fa fa-file-excel-o"></i> <?= __("Export to Excel"); ?>',titleAttr:"Excel",className:"btn btn-default btn-sm",footer:!0,exportOptions:{columns:":visible:not(.no-print):not(.dt-checkboxes-cell)",format:{footer:function(t,e,a){return $(a).prop("outerHTML").indexOf("no-print")>0?t.replace(t,""):t}}},messageTop:function(){if(void 0!==$("#DtExportTopMessage").html())return $("#DtExportTopMessage").html()}},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> <?= __("Export to PDF"); ?>',titleAttr:"PDF",className:"btn btn-default btn-sm",exportOptions:{columns:":visible:not(.no-print):not(.dt-checkboxes-cell)",format:{footer:function(t,e,a){return $(a).prop("outerHTML").indexOf("no-print")>0?t.replace(t,""):t}}},messageTop:function(){if(void 0!==$("#DtExportTopMessage").html())return $("#DtExportTopMessage").html()}},{extend:"colvis",text:'<i class="fa fa-columns"></i> <?= __("Hide"); ?>',className:"btn btn-default btn-sm",collectionLayout:"fixed"}]}),s.buttons().container().appendTo(".printButtonPosition")),$("#dataTableWithAjaxExtend tbody").on("click",".has-child-row",(function(){var t=$(this).closest("tr"),e=s.row(t),a=$(this).attr("data-parent-product-id"),o=$("#productReportWarehouseSelection").select2("data")[0].id,r=$(this).text(),n=this;e.child.isShown()?(e.child.hide(),t.removeClass("shown")):($(n).html(`${r} <i style='margin-left: 5px;' class='fa fa-spinner fa-spin'></i>`),BMS.fn.get(`getChildProductData&pid=${a}&wid=${o}`,(function(a){0==a?BMS.fn.alertError("Sorry! no item found."):(e.child(function(t){var e=s.columns().visible(),a="";return t.forEach((t=>{a+='<tr class="childRow" style="display: none; background-color: #f2fcff;">',t.forEach(((t,o)=>{var r=s.columns().header()[o].className;a+=e[o]?`<td class='${r}'>${t}</td>`:""})),a+="</tr>"})),$(a).toArray()}(a)).show(),t.addClass("shown"),$("tr.childRow").fadeIn("slow")),$(n).html(`${r}`)})))}))},select2:function(t,e="",a=""){var o=$(t).attr("select2-ajax-url"),r=$(t).attr("select2-minimum-input-length"),n="true"===$(t).attr("select2-tag"),l="false"!==$(t).attr("closeOnSelect"),s="";s=void 0===$(t).attr("select2-create-new-url")?"<?php echo __('Nothing found')?>":`<span class="createNewSelect2Item" onClick="BMS.fn.createNewSelect2Item('#${$(t).attr("id")}')" style="cursor: pointer; display: block;"> <i class="fa fa-plus"></i> <?php echo __("Create new..."); ?></span>`,$(document).on("keyup",".select2-search__field",(function(t){"Enter"===t.key&&$(".createNewSelect2Item").click()}));var i=$(t).select2({placeholder:$(t).children("option:first").html()?$(t).children("option:first").html():"Select Options",allowClear:!0,closeOnSelect:l,tags:n,minimumInputLength:r,language:{noResults:function(){return s}},escapeMarkup:function(t){return t},ajax:{url:o,dataType:"json",delay:250,processResults:function(t){return{results:t}},cache:!0},templateResult:function(t){if(!t.id)return t.text;if("object"==typeof t.text){var e=t.text,a="";return a+=` <div style="width: 98%;" class='row'>\n <div class='col-md-5'>${e[0]}</div>\n <div class='col-md-1'>Cost</div>\n <div class='col-md-1'>Price</div>\n <div class='col-md-2'>Stock</div>\n <div class='col-md-3 adjustFormGroupPaddingRight'>Brand</div>\n </div>\n `,a+=` <div style="width: 98%;" class='row'>\n <div class='col-md-5'>${e[1]}</div>\n <div class='col-md-1'>${e[2]}</div>\n <div class='col-md-1'>${e[3]}</div>\n <div class='col-md-2'>${e[4]}</div>\n <div class='col-md-3 adjustFormGroupPaddingRight'>${e[5]}</div>\n </div>\n `}return t.text}});if(""!==a&&""===e)$.ajax({type:"get",url:o+"&q="+a}).then((function(t){if(void 0!==(t=JSON.parse(t)[0])){var e=new Option(t.text,t.id,!0,!0);i.append(e).trigger("change")}}));else if(""!==e&&i.find(":selected").val()!==e){var c=new Option(a,e,!0,!0);i.append(c).trigger("change")}},get:function(t,e){$.ajax({url:full_website_address+`/info/?module=data&page=${t}`,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,a){e(t)},error:function(){e("")}})}},BMS.fn=BMS.FUNCTIONS,BMS.MAIN={printPage:function(t,e,a=function(){}){e.preventDefault();var o=document.createElement("iframe");o.onload=function(){this.contentWindow.onbeforeunload=function(){$(".dynamic-container > iframe").remove(),a(!0)},this.contentWindow.onafterprint=function(){$(".dynamic-container > iframe").remove(),a(!0)},this.contentWindow.focus(),this.contentWindow.print()},o.style.position="fixed",o.style.right="0",o.style.bottom="0",o.style.width="0",o.style.height="0",o.style.border="0",o.src=t,$(".dynamic-container").append(o)},addTariffChargesRow:function(t){$(t).append(`<div class="row"><br/> \n <div class="col-md-7"> \n <select name="tariffChargesName[]" class="form-control select2Ajax tariffChargesName" select2-ajax-url="${full_website_address}/info/?module=select2&page=tariffCharges"> \n <option value="">Select Tariff/Charges</option> \n </select> \n </div> \n <div class="col-md-4"> \n <input type="number" name="tariffChargesAmount[]" class="form-control tariffChargesAmount" step="any"> \n </div> \n <div class="col-md-1"> \n <i style="cursor: pointer; padding-top: 9px;" class="fa fa-trash-o removeThisTariffCharges"></i> \n </div> \n </div>`)}},BMS.PRODUCT={isExists:function(t,e=".productID"){return $(e).filter((function(){return this.value===t})).length>0},validationCheck:function(t,e,a){if(this.isExists(t.pid))return alert(`The product (${t.pn}) is already in the list.`);if(void 0===t.pv)return a(t);var o="",r={},n=[],l={};$.each(t.pv,(function(t,e){Array.isArray(r[e.mk])?r[e.mk].includes(e.mv)||r[e.mk].push(e.mv):r[e.mk]=[e.mv],"DV"===e.t?n.push(e.mv):Array.isArray(l[e.id])?l[e.id].push(e.mv):l[e.id]=[e.mv]})),$.each(r,(function(t,e){o+=`<div id="variationSelection" class="form-group row text-left">\n <label class="col-sm-4">${t}:</label>\n <div class="col-sm-8">\n <select class="form-control">\n <option value="">Select ${t}...</option>`,$.each(e,(function(t,e){o+="<option "+(n.includes(e)?"selected":"")+` value="${e}">${e}</option>`})),o+=" </select>\n </div>\n </div>"})),Swal.fire({title:"<strong>Select Variation</strong>",html:"for "+t.pn+" <br/><br/>"+o,showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"Ok"}).then((t=>{if(t.isConfirmed){var a=$("#variationSelection select"),o=[];$.each(a,(function(){""!==this.value&&o.push(this.value)}));var r="";$.each(l,(function(t,e){if(o.every((t=>e.includes(t))))return r=t,!1})),""===r||0===o.length?Swal.fire("Sorry! no product found"):e.addProduct(r)}}))},parseProductList:function({category:t="",brand:e="",edition:a="",generic:o="",author:r=""},n){$.ajax({url:full_website_address+`/info/?module=data&page=productList&catId=${t}&brand=${e}&edition=${a}&generic=${o}&author=${r}`,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e){n(t)}})},showProduct:function({container:t="#productListContainer",category:e="",brand:a="",edition:o="",generic:r="",author:n=""}=""){this.parseProductList({category:e,brand:a,edition:o,generic:r,author:n},(e=>{if(null!=e){var a="";e.forEach((t=>{var e=full_website_address;t.v&&t.v>0?e+="/images/?for=products&id="+t.id+"&q=YTozOntzOjI6Iml3IjtpOjIwMDtzOjI6ImloIjtpOjIyMDtzOjI6ImlxIjtpOjcwO30=&v="+t.v:e+="/assets/images/noimage.png",a+="<button type='button' value='"+t.id+"' title='"+t.name+"' data-toggle='tooltip' class='productButton btn-product btn-default'> <img src='"+e+"' style='width:60px; height:60px;' alt='"+t.name+"'> <span> "+t.name+" </span> </button> "})),$(t).html(a)}else $(t).html("<div class='alert alert-danger'>Sorry! No products found in this criteria.</div>")}))},getDetails:function(t,e){$.ajax({url:full_website_address+`/info/?module=data&page=productDetails&product_id=${t}`,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,a){e(t)}})},addProduct:function(t="",e=!1){var a=""===t?$("#selectProduct").val():t;""!==a?this.getDetails(a,(t=>{t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{if("1"!==t.hed){var e=t.iq?parseFloat(t.iq).toFixed(0):1,a=`<tr>\n <input type="hidden" name="bgProductID[]" class="productID" value="${t.pid}">\n <td class="col-md-5">${t.pn}</td>\n <td class="col-md-3"><input onclick = "this.select()" type="text" name="bgProductQnt[]" value="${e}" class="productQnt form-control text-center"></td>\n <td class="col-md-2">${t.pu}</td>\n <td class="text-right col-md-2 gbProductPrice"><input onclick = "this.select()" type="text" name="bgProductSalePrice[]" value="${t.sp}" class="productSalePrice form-control text-center" step="any"></td>\n <td style="width: 28px !important;">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(a)}else BMS.fn.alertError("Sorry! The product which have expiry date or batch number, can not be added in sub/bundle product.")})),$("#selectProduct").empty()})),!1===e&&$("#productTable > tbody tr:last").find(".productQnt").select()})):alert("Please select a product")},getListByGeneric:function(t){BMS.fn.select2("#productGenericFilter",t,t)},productUnitCheck:function(t){this.getDetails({product_id:$(t).closest("tr").find(".productID").val(),unit:$(t).val()},(e=>{$(t).closest("tr").find(".productSalePrice").val(e[0].sp)}))}},BMS.POS={clearScreen:function(){$(".dynamic-container").slideUp(350,(function(){var t=new Date;$("#salesDate").val(t.toISOString().split("T")[0]),$("#tariffCharges .row").not("div:first").remove(),$(".tariffChargesName").val("").change();$(".paymentMethodBox").html('<div style="margin: 0;" class="row">\n <div class="form-group pull-right col-md-3 adjustFormGroupPadding">\n <label>Amount</label>\n <input type="number" onclick="this.select();" name="posSalePaymentAmount[]" class="form-control posSalePaymentAmount" step="any">\n </div>\n <div class="form-group pull-right col-md-3 adjustFormGroupPadding">\n <label>Reference/Info</label>\n <input type="text" name="posSalePaymentReference[]" class="form-control">\n </div>\n <div style="display: none;" class="posSalePaymentBankAccount form-group pull-right col-md-3 adjustFormGroupPadding">\n <label>Bank Account</label>\n <select name="posSalePaymentBankAccount[]" class="form-control pull-left select2Ajax" \n select2-ajax-url="<?php echo full_website_address() ?>/info/?module=select2&page=accountList" style="width: 100%;">\n <option value=""><?php echo __("Select Account"); ?>....</option>\n </select>\n </div>\n <div class="form-group pull-right col-md-3 adjustFormGroupPadding">\n <label>Payment Method</label>\n <select name="posSalePaymentMethod[]" class="posSalePaymentMethod form-control">\n <option value="Cash"><?php echo __("Cash"); ?></option>\n <option value="Bank Transfer"><?php echo __("Bank Transfer"); ?></option>\n <option value="Cheque"><?php echo __("Cheque"); ?></option>\n <option value="Card"><?php echo __("Card"); ?></option>\n <option value="Others"><?php echo __("Others"); ?></option>\n </select>\n </div>\n </div>'),$("#orderDiscountValue, #shippingCharge, .posSalePaymentAmount, #adjustAmount, #salesNote").val(""),$("#shippingCharge").removeClass("shippingChargeEdited"),$(".posSalePaymentAmount").removeClass("disablePaymentAmountAutoChange"),$("#productTable > tbody").html(""),$("#editSalesId").remove(),$("#payment .modal-footer").html('\n <button type="button" class="btn btn-default pull-left" data-dismiss="modal"><?= __("Close"); ?></button>\n <button name="posAction" value="sale_is_confirmed" style="visibility: hidden;" type="submit"></button>\n <button name="posAction" value="sale_is_hold" type="submit" class="posSubmit btn btn-warning"><i class="fa fa-pause-circle"></i> <?= __("Hold"); ?></button>\n <button name="posAction" value="sale_is_confirmed" type="submit" class="posSubmit btn btn-success"><i class="fa fa-check-circle"></i> <?= __("Confirm"); ?></button>\n '),$("input:radio, input:checkbox").prop("checked",!1),BMS.fn.select2("#customers",1,"Walk-in Customer"),BMS.POS.grandTotal(),BMS.POS.disableEnableWCSelect()})).slideDown(500)},getProductDetails:function({product_id:t,warehouse_id:e,customer_id:a="",qnt:o="",batch:r="",packet:n=""},l){$.ajax({url:full_website_address+`/info/?module=data&page=productDetailsForPos&product_id=${t}&warehouse_id=${e}&cid=${a}&pqnt=${o}&batch=${r}&packet=${n}`,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e){l(t)}})},disableEnableWCSelect:function(){$(".productQnt").length>0?$("#customers, #warehouse").prop("disabled",!0):$("#customers, #warehouse").prop("disabled",!1)},grandTotal:function(t=""){var e=0,a=0;$(".productQnt").each((function(){e+=Number($(this).val()),a+=1})),$(".totalItemAndQnt").html(a+" ("+e+")");var o=0;$(".subtotalCol").each((function(){o+=Number($(this).html())})),$(".totalAmount").html(o.toFixed(2));var r=$("#orderDiscountValue").val(),n=BMS.FUNCTIONS.calculateDiscount(o,r);$(".totalOrderDiscountAmount").html("(-) "+(o-n).toFixed(2));var l=0;if($("#tariffCharges > .row").each((function(){var t=$(this).closest(".row").find(".tariffChargesName").val().split(": ")[1],e=BMS.FUNCTIONS.calculateTarifCharges(n,t);$(this).closest(".row").find(".tariffChargesAmount").val(e),l+=Number(e)})),$(".totalTariffChargesAmount").html("(+) "+l.toFixed(2)),!0===$("#payment").hasClass("in")){if(!1===$("#shippingCharge").is(":focus")&&($("#totalPackets").is(":focus")||$("#packetShippingRate").is(":focus"))){var s=$("#totalPackets").val()*$("#packetShippingRate").val();$("#shippingCharge").val(s)}}else{var i=0;$(".productPacket").each((function(){i+=Number($(this).val())})),$(".displayTotalPackets").html(i.toFixed(2)),$("#totalPackets").val(Math.round(i));s=$("#totalPackets").val()*$("#packetShippingRate").val();$("#shippingCharge").val(s)}var c=(Number(l)+Number(n)).toFixed(2);$(".netTotalAmount").html(c),$("#finalizeSale > tbody > tr:nth-child(1) > td:nth-child(3)").html(c);var d=Number($("#shippingCharge").val()),u=Number(c)+d;"1"===config.posSaleAutoAdjustAmount&&$("#adjustAmount:not(.disableAdjustAmountAutoChange)").val(parseFloat(parseFloat(u).toFixed()-u).toFixed(2));var p=Number($("#adjustAmount").val());u=parseFloat(Number(c)+d+Number(p)).toFixed(2);if("1"===config.posSaleAutoMarkAsPaid){var m=sumInputs(".disablePaymentAmountAutoChange"),h=0;(u>0&&u>m||u<0&&u<m)&&(h=u-m),$(".posSalePaymentAmount:not(.disablePaymentAmountAutoChange)").first().val(parseFloat(h).toFixed(2))}var f=sumInputs(".posSalePaymentAmount"),v=u<f?f-u:0,g=u>f?u-f:0;$("#finalizeSale > tbody > tr:nth-child(4) > td:nth-child(2)").html(u),$("#finalizeSale > tbody > tr:nth-child(6) > td:nth-child(2)").html(v),$("#finalizeSale > tbody > tr:nth-child(7) > td:nth-child(2)").html(g),$("#quickPayableAmount").html(u),!0===$("#payment").hasClass("in")&&(u>0&&u<f||u<0&&u>f)&&(Swal.fire({title:"Paid amount can not be more then Grand total.",icon:"error"}),$(".posSalePaymentAmount").last().val(0))},editProductItemDetails:function(t,e){$("#productSaleDetails .modal-title").html(e),$("#productSaleDetails .rowId").val(t);var a=$(`#${t}`);$("#productSaleDetails #productSaleItemPrice").val(a.find(".netSalesPrice").val()),$("#productSaleDetails #productSaleItemDiscount").val(a.find(".productDiscount").val()),$("#productSaleDetails #productSaleItemPacket").val(a.find(".productPacket").val()),$("#productSaleDetails #productSaleItemDetails").val(a.find(".productItemDetails").val())},addProduct:function(t="",e=!1){var a=""===t?$("#selectProduct").val():t;""!==a?($("#selectProduct").val()>0&&$("#selectProduct").html("<option value=''>Search Product....</option>"),this.getProductDetails({product_id:a,warehouse_id:$("#warehouseId").val(),customer_id:$("#customersId").val()},(t=>{void 0===t.error||!0!==t.error?(t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e=0,o=t.iq?parseFloat(t.iq).toFixed(0):1;t.pq>0&&(e=(o/Number(t.pq)).toFixed(2));var r=t.pd?t.pd:"0",n=BMS.FUNCTIONS.calculateDiscount(t.sp,r),l="";l=Number(n)===Number(t.sp)?parseFloat(t.sp).toFixed(2):"<span>"+parseFloat(n).toFixed(2)+"</span><span><del><small>"+parseFloat(t.sp).toFixed(2)+"</small></del></span>";var s=Date.now()+t.pid,i=null===t.gn?"":`<small style="cursor: zoom-in;" onClick="BMS.PRODUCT.getListByGeneric('${t.gn}')"><i>${t.gn}</i></small>`,c=`<tr ${t.so?'style="background-color: pink;"':""} id=${s}> \n <td class="col-md-7">\n <span data-toggle="modal" data-target="#modalDefault" href="${full_website_address}/xhr/?module=reports&page=totalPurchasedQuantityOfThisCustomer&cid=${$("#customersId").val()}&pid=${a}"> <i class="fa fa-info-circle productDescription"></i> </span> \n <a href="#" data-toggle="modal" onclick="BMS.POS.editProductItemDetails('${s}', '${t.pn}')" data-target="#productSaleDetails">${t.pn}</a>\n ${i}\n </td> \n <td class="col-md-2 displayProductPrice text-right">${l}</td> \n <td class="col-md-2"><input onclick = "this.select()" type="text" name="productQnt[]" value="${o}" class="productQnt form-control text-center" autoComplete="off"></td>\n <td class="col-md-2">${t.pu}</td> \n <td class="col-md-3 subtotalCol text-right">${parseFloat(Number(n)*Number(o)).toFixed(2)}</td> \n <td style="width: 25px !important;"> \n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i> \n </td> \n <input type="hidden" name="productID[]" class="productID" value="${t.pid}"> \n <input type="hidden" class="netSalesPrice" name="productSalePirce[]" value="${t.sp}"> \n <input type="hidden" class="productMainSalePirce" name="productMainSalePirce[]" value="${t.sp}"> \n <input type="hidden" class="productSO" value="${t.so}"> \n <input type="hidden" name="productDiscount[]" value="${r}" class="productDiscount" autoComplete="off"> \n <input type="hidden" name="productBatch[]" value="">\n <input type="hidden" name="productHasExpiryDate[]" value="${t.hed}"> \n <input type="hidden" name="productPacket[]" value="${e}" class="productPacket"> \n <input type="hidden" name="productItemDetails[]" class="productItemDetails" value=""> \n </tr>`;$("#productTable > tbody").append(c)}))})),!1===e&&$("#productTable > tbody tr:last").find(".productQnt").select(),this.grandTotal(),this.disableEnableWCSelect()):Swal.fire({title:"Error!",text:t.msg,icon:"error"})}))):alert("Please select a product")},addReturnProduct:function(t,e,a,o,r,n,l,s,i,c){if(!BMS.PRODUCT.isExists(t)||confirm(`The product (${e}) is already in the list. Do you want to add it again?`)){var d=Date.now()+t,u=`<tr id=${d}> \n <td class="col-md-7">\n <span> <i class="fa fa-undo productDescription"></i> </span> \n <a href="#" data-toggle="modal" onclick="BMS.POS.editProductItemDetails(${d}, '${e}')" data-target="#productSaleDetails">${e}</a>\n ${null===a?"":`<small style="cursor: zoom-in;" onClick="BMS.PRODUCT.getListByGeneric('${a}')"><i>${a}</i></small>`}\n </td> \n <td class="col-md-2 displayProductPrice text-right">${s}</td> \n <td class="col-md-2"><input onclick = "this.select()" type="text" name="productQnt[]" value="-${i}" class="productQnt form-control text-center" autoComplete="off"></td>\n <td class="col-md-2">${r}</td> \n <td class="col-md-3 subtotalCol text-right">-${c}</td> \n <td style="width: 25px; !important"> \n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i> \n </td> \n <input type="hidden" name="productID[]" class="productID" value="${t}"> \n <input type="hidden" class="netSalesPrice" name="productSalePirce[]" value="${s}"> \n <input type="hidden" class="productMainSalePirce" name="productMainSalePirce[]" value="${s}"> \n <input type="hidden" name="productDiscount[]" value="${l}" class="productDiscount" autoComplete="off"> \n <input type="hidden" name="productBatch[]" value="${o}">\n <input type="hidden" name="productHasExpiryDate[]" value="${n}"> \n <input type="hidden" name="productPacket[]" value="0" class="productPacket"> \n <input type="hidden" name="productItemDetails[]" class="productItemDetails" value=""> \n </tr>`;$("#productTable > tbody").append(u),this.grandTotal()}},productQntCheck:function(t,e){var a=$(t).closest("tr").find(".netSalesPrice").val(),o=$(t).val(),r=$(t).closest("tr").find(".productDiscount").val(),n=$(t).closest("tr").find("td.subtotalCol"),l=$(t).closest("tr").find(".productPacket"),s=t;0==o&&(Swal.fire({title:"Error!",text:"Product qunatity can not be zero (0)",icon:"error"}),$(t).val(1),o=1),this.getProductDetails({product_id:$(t).closest("tr").find(".productID").val(),warehouse_id:$("#warehouseId").val(),qnt:o,unit:$(t).closest("tr").find(".productItemUnit").val()},(e=>{void 0!==e.error&&!0===e.error&&($(s).val(e.stq),o=e.stq,Swal.fire({title:"Error!",text:e.msg,icon:"error"})),(e=e[0]?e[0]:e).so?$(t).closest("tr").css("background-color","pink"):$(t).closest("tr").css("background-color","white"),$(n).html((BMS.FUNCTIONS.calculateDiscount(a,r)*o).toFixed(2));var i=0;Number(e.pq)>0&&(i=(o/Number(e.pq)).toFixed(2)),l.val(i),this.grandTotal()}))},productPacketCheck:function(){var t=$(selector).closest("tr").find(".netSalesPrice").val(),e=$(selector).val(),a=$(selector).closest("tr").find(".productDiscount").val(),o=$(selector).closest("tr").find("td.subtotalCol"),r=$(selector).closest("tr").find(".productQnt"),n=$(selector).closest("tr").find(".productPacket");this.getProductDetails({product_id:$(selector).closest("tr").find(".productID").val(),warehouse_id:$("#warehouseId").val(),packet:e},(l=>{if(void 0!==l.error&&!0===l.error){$(r).val(l.having_item_quantity),$(o).html((BMS.FUNCTIONS.calculateDiscount(t,a)*l.having_item_quantity).toFixed(2));var s=0;Number(l.product_packet_quantity)>0&&(s=(l.having_item_quantity/Number(l.product_packet_quantity)).toFixed(2)),n.val(s),Swal.fire({title:"Error!",text:l.msg,icon:"error"})}else{var i=Math.round(Number(l.product_packet_quantity)*e);i>0&&($(r).val(i),$(o).html((BMS.FUNCTIONS.calculateDiscount(t,a)*i).toFixed(2)))}this.grandTotal()}))},productDiscountCheck:function(t){var e=$("#productSaleItemPrice").val(),a=$("#productSaleItemDiscount").val();"Enter"===t.key&&a.indexOf("%")>1&&a.replace("%","")>=100?(Swal.fire({title:"Error!",text:"Discount Must be below of 100%",icon:"error"}),$("#productSaleItemDiscount").val(""),$("#productSaleItemDiscount").select(),t.preventDefault()):"Enter"===t.key&&Number(a)>=Number(e)&&a.indexOf("%")<1&&($("#productSaleItemDiscount").val(""),$("#productSaleItemDiscount").select(),"Enter"===t.key&&t.preventDefault(),Swal.fire({title:"Error!",text:"Discount Must be below of product sale price",icon:"error"}),t.preventDefault())},orderDiscountCheck:function(t,e){var a=$(".totalAmount").html(),o=$(t).val();o.indexOf("%")>1&&o.replace("%","")>=100?(Swal.fire({title:"Error!",text:"Discount Must be below of 100%",icon:"error"}),$(t).val(0),e.preventDefault()):Number(a)<0&&Number(o)>0?(Swal.fire({title:"Error!",text:"Discount must be a nagative amount in case of nagative total amount.",icon:"error"}),$(t).val(-Number(o)),e.preventDefault()):(Number(a)<0&&(Number(o)>0||Math.abs(Number(o))>=Math.abs(Number(a)))||Number(a)>0&&Number(o)>=Number(a)&&o.indexOf("%")<1)&&(Swal.fire({title:"Error!",text:"Discount Must be below of total amount.",icon:"error"}),$(t).val(0),e.preventDefault()),this.grandTotal()}},BMS.PURCHASE={getProductDetails:BMS.PRODUCT.getDetails,grandTotal:function(){var t=0;$(".productQnt").each((function(){t+=Number($(this).val())})),$("#totalItems").html($(".productQnt").length+"("+t+")");var e=0;$(".subTotal").each((function(){e+=Number($(this).html())})),$(".totalPurchasePrice").html(e.toFixed(2));var a=BMS.FUNCTIONS.calculateDiscount(e,$("#purchaseDiscountValue").val());$(".totalPurchaseDiscount").html("(-) "+(e-a).toFixed(2));var o=0;$("#tariffCharges > .row").each((function(){var t=$(this).closest(".row").find(".tariffChargesName").val().split(": ")[1],e=BMS.FUNCTIONS.calculateTarifCharges(a,t);$(this).closest(".row").find(".tariffChargesAmount").val(e),o+=Number(e)})),$(".totalTariffCharges").html("(+) "+o.toFixed(2));var r=(Number(o)+Number(a)).toFixed(2);$(".netTotal").html(r),$("#purchaseNetTotal").val(r);var n=Number(r)+Number($("#purchaseShipping").val());$("#purchaseGrandTotal").val(n);var l=Number($("#purchasePaidAmount").val()),s=n<=l?0:n-l,i=n>=l?0:l-n;$("#purchaseChangeAmount").val(i),$("#purchaseDueAmount").val(s)},calculateEachProduct:function(t){var e=$(t).closest("tr").find(".productPurchasePrice").val(),a=$(t).closest("tr").find(".productQnt").val(),o=$(t).closest("tr").find(".productPurchaseDiscount").val(),r=$(t).closest("tr").find(".subTotal");return isNaN(a)?(alert("Product quantity must be a valid number."),void $(t).closest("tr").find(".productQnt").val(1)):a<1?(alert("Product quantity must be minimum of 1."),void $(t).closest("tr").find(".productQnt").val(1)):(""!==e&&null!==e&&"null"!==e||(e=0,$(t).closest("tr").find(".productPurchasePrice").val(0)),o.indexOf("%")>1&&o.replace("%","")>=100?($(t).closest("tr").find(".productPurchaseDiscount").val(0),void alert("Discount Must be below of 100%")):Number(o)>Number(e)&&o.indexOf("%")<1?($(t).closest("tr").find(".productPurchaseDiscount").val(0),void alert("Discount Must be below of product purchase price")):void $(r).html((BMS.FUNCTIONS.calculateDiscount(e,o)*a).toFixed(2)))},addProduct:function(t="",e=!1){var a=""===t?$("#selectProduct").val():t;""!==a?this.getProductDetails(a,(t=>{t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e="<input type='hidden' name='productBatch[]' value=''>";void 0!==t.hed&&"1"===t.hed&&(e=`<select name="productBatch[]" id="productBatchFor${t.pid}" class="form-control select2Ajax" select2-create-new-url="<?php echo full_website_address(); ?>/xhr/?tooltip=true&module=stock-management&page=newBatchForSelectedProduct&pid=${t.pid}" select2-ajax-url="<?php echo full_website_address(); ?>/info/?module=select2&page=batchList&pid=${t.pid}" required>\n <option value=""><?= __("Select Batch"); ?>....</option>\n </select>`);var a=t.iq?parseFloat(t.iq).toFixed(0):1,o=`<tr> <input type="hidden" name="productID[]" class="productID" value="${t.pid}">\n <td class="col-md-4">${t.pn}</td>\n <td class="col-md-2">${e}</td>\n <td class="col-md-1"><input onclick = "this.select()" type="text" name="productQnt[]" value="${a}" class="productQnt form-control text-center"></td>\n <td class="col-md-1">${t.pu}</td>\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productPurchasePrice[]" value="${t.pp}" class="productPurchasePrice form-control text-center" step="any"></td>\n <input type="hidden" name="productMainPurchasePrice[]" class="productMainPurchasePrice" value="${t.pp}" step="any">\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productPurchaseDiscount[]" value="0" placeholder="10% or 10" class="productPurchaseDiscount form-control text-center"></td>\n <td class="text-right subTotal">${t.pp}</td>\n <td style="width: 30px; !important">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(o)}))})),!1===e&&$("#productTable > tbody tr:last").find(".productQnt").select(),this.grandTotal(),$("#selectProduct").empty()})):alert("Please select a product")},productUnitCheck:function(t){var e=$(t).closest("tr").find(".productID").val(),a=this;$.ajax({url:full_website_address+"/info/?module=data&page=productUnitDetails&product_id="+e+"&unit="+$(t).val(),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e,o){"success"==o&&($(t).closest("tr").find(".productPurchasePrice").val(e.pp),$(t).closest("tr").find(".productMainPurchasePrice").val(e.pp),a.calculateEachProduct(t),a.grandTotal())}})}},BMS.ORDER=Object.assign({},BMS.POS),BMS.ORDER.addProduct=function(t=""){var e=""===t?$("#selectProduct").val():t;""!==e?($("#selectProduct").val()>0&&$("#selectProduct").html("<option value=''>Search Product....</option>"),BMS.PRODUCT.getDetails(e,(t=>{t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var a=0,o=t.iq?parseFloat(t.iq).toFixed(0):1;t.pq>0&&(a=(o/Number(t.pq)).toFixed(2));var r=t.pd?t.pd:"0",n=BMS.FUNCTIONS.calculateDiscount(t.sp,r),l="";l=Number(n)===Number(t.sp)?parseFloat(t.sp).toFixed(2):"<span>"+n+"</span><span><del><small>"+parseFloat(t.sp).toFixed(2)+"</small></del></span>";var s=Date.now()+t.pid,i=`<tr ${t.so?'style="background-color: pink;"':""} id=${s}> \n <td class="col-md-7">\n <span data-toggle="modal" data-target="#modalDefault" href="${full_website_address}/xhr/?module=reports&page=totalPurchasedQuantityOfThisCustomer&cid=${$("#customersId").val()}&pid=${e}"> <i class="fa fa-info-circle productDescription"></i> </span> \n <a href="#" data-toggle="modal" onclick="BMS.POS.editProductItemDetails('${s}', '${t.pn}')" data-target="#productSaleDetails">${t.pn}</a>\n </td> \n <td class="col-md-2 displayProductPrice text-right">${l}</td> \n <td class="col-md-2"><input onclick = "this.select()" type="text" name="productQnt[]" value="${o}" class="productQnt form-control text-center" autoComplete="off"></td>\n <td class="col-md-2">${t.pu}</td> \n <td class="col-md-3 subtotalCol text-right">${parseFloat(Number(n)*Number(o)).toFixed(2)}</td> \n <td style="width: 25px !important;"> \n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i> \n </td> \n <input type="hidden" name="productID[]" class="productID" value="${t.pid}"> \n <input type="hidden" class="netSalesPrice" name="productSalePirce[]" value="${t.sp}"> \n <input type="hidden" class="productMainSalePirce" name="productMainSalePirce[]" value="${t.sp}"> \n <input type="hidden" class="productSO" value="${t.so}"> \n <input type="hidden" name="productDiscount[]" value="${r}" class="productDiscount" autoComplete="off"> \n <input type="hidden" name="productBatch[]" value="">\n <input type="hidden" name="productHasExpiryDate[]" value="${t.hed}"> \n <input type="hidden" name="productPacket[]" value="${a}" class="productPacket"> \n <input type="hidden" name="productItemDetails[]" class="productItemDetails" value=""> \n </tr>`;$("#productTable > tbody").append(i)}))})),$("#productTable > tbody tr:last").find(".productQnt").select(),this.grandTotal(),this.disableEnableWCSelect()}))):alert("Please select a product")},BMS.ORDER.productQntCheck=function(t,e){var a=$(t).closest("tr").find(".netSalesPrice").val(),o=$(t).val(),r=$(t).closest("tr").find(".productDiscount").val(),n=$(t).closest("tr").find("td.subtotalCol");0==o&&(Swal.fire({title:"Error!",text:"Product qunatity can not be zero (0)",icon:"error"}),$(t).val(1),o=1),$(n).html((BMS.FUNCTIONS.calculateDiscount(a,r)*o).toFixed(2)),this.grandTotal()},BMS.STOCK_TRANSFER={getProductDetails:BMS.POS.getProductDetails,grandTotal:function(){var t=0;$(".productQnt").each((function(){t+=Number($(this).val())})),$("#totalItems").html($(".productQnt").length+"("+t+")");var e=0;$(".subTotal").each((function(){e+=Number($(this).html())})),$(".totalPurchasePrice").html(e.toFixed(2))},disableEnableWarehouseSelect:function(){$(".productQnt").length>0?$("#stockTransferFromWarehouse, #stockTransferToWarehouse").prop("disabled",!0):$("#stockTransferFromWarehouse, #stockTransferToWarehouse").prop("disabled",!1)},calculateEachProduct:function(t){var e=$(t).closest("tr").find(".productPurchasePrice").val(),a=$(t).closest("tr").find(".productQnt").val(),o=$(t).closest("tr").find(".productPurchaseDiscount").val(),r=$(t).closest("tr").find(".subTotal");return a<1?(alert("Product quantity must be minimum of 1."),void $(t).closest("tr").find(".productQnt").val(1)):(""!==e&&null!==e&&"null"!==e||(e=0,$(t).closest("tr").find(".productPurchasePrice").val(0)),o.indexOf("%")>1&&o.replace("%","")>=100?($(t).closest("tr").find(".productPurchaseDiscount").val(0),void alert("Discount Must be below of 100%")):Number(o)>Number(e)&&o.indexOf("%")<1?($(t).closest("tr").find(".productPurchaseDiscount").val(0),void alert("Discount Must be below of product purchase price")):void $(r).html((BMS.FUNCTIONS.calculateDiscount(e,o)*a).toFixed(2)))},addProduct:function(t="",e=!1){var a=""===t?$("#selectProduct").val():t,o=$("#stockTransferFromWarehouseId").val();""!==o?""!==a?this.getProductDetails({product_id:a,warehouse_id:o,qnt:1},(t=>{void 0===t.error||!0!==t.error?(t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e="<input type='hidden' name='productBatch[]' value=''>";void 0!==t.hed&&"1"===t.hed&&(e=`<select name="productBatch[]" id="productBatch" class="form-control select2Ajax" select2-create-new-url="<?php echo full_website_address(); ?>/xhr/?tooltip=true&module=stock-management&page=newBatchForSelectedProduct&pid=${t.pid}" select2-ajax-url="<?php echo full_website_address(); ?>/info/?module=select2&page=batchList&pid=${t.pid}" required>\n <option value=""><?= __("Select Batch"); ?>....</option>\n </select>`);var a=t.iq?parseFloat(t.iq).toFixed(0):1,o=`<tr>\n <input type="hidden" name="productID[]" class="productID" value="${t.pid}">\n <td class="col-md-4">${t.pn}</td>\n <td class="col-md-2">${e}</td>\n <td class="col-md-1"><input onclick = "this.select()" type="text" name="productQnt[]" value="${a}" class="productQnt form-control text-center"></td>\n <td class="col-md-1"> ${t.pu}</td>\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productPurchasePrice[]" value="${t.pp}" class="productPurchasePrice form-control text-center" step="any"></td>\n <input type="hidden" name="productMainPurchasePrice[]" value="${t.pp}" step="any">\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productPurchaseDiscount[]" value="" placeholder="10% or 10" class="productPurchaseDiscount form-control text-center"></td>\n <td class="text-right subTotal">${parseFloat(t.pp*a).toFixed(2)}</td>\n <td style="width: 30px; !important">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(o)}))})),this.grandTotal(),this.disableEnableWarehouseSelect(),$("#selectProduct").empty()):Swal.fire({title:"Error!",text:t.msg,icon:"error"})})):alert("Please select a product"):alert("Please select an warehouse to add product")},productUnitCheck:function(t){var e=t;this.getProductDetails({product_id:$(t).closest("tr").find(".productID").val(),warehouse_id:$("#stockTransferFromWarehouseId").val(),qnt:$(t).closest("tr").find(".productQnt").val(),unit:$(t).val()},(t=>{void 0!==t.error&&!0===t.error&&(console.log(t.stq),$(e).closest("tr").find(".productQnt").val(t.stq),Swal.fire({title:"Error!",text:t.msg,icon:"error"})),$(e).closest("tr").find(".productPurchasePrice").val(parseFloat(t.pp).toFixed(2)),this.calculateEachProduct(e),this.grandTotal()}))},productQntCheck:function(t){var e=$(t).val(),a=$(t);isNaN(e)&&(alert("Product quantity must be a valid number."),$(t).val(1),e=1),e<1&&(Swal.fire({title:"Error!",text:"Product qunatity must be at least one",icon:"error"}),$(t).val(1),e=1),this.getProductDetails({product_id:$(t).closest("tr").find(".productID").val(),warehouse_id:$("#stockTransferFromWarehouseId").val(),qnt:e,unit:$(t).closest("tr").find(".productItemUnit").val()},(t=>{void 0!==t.error&&!0===t.error&&($(a).val(t.stq),Swal.fire({title:"Error!",text:t.msg,icon:"error"})),this.calculateEachProduct(a),this.grandTotal()}))}},BMS.STOCK_ENTRY={getProductDetails:BMS.PRODUCT.getDetails,grandTotal:function(){var t=0;$(".productQnt").each((function(){t+=Number($(this).val())})),$("#totalItems").html($(".productQnt").length+"("+t+")");var e=0;$(".subTotal").each((function(){e+=Number($(this).html())})),$(".totalPurchasePrice").html(e.toFixed(2))},calculateEachProduct:function(t){var e=$(t).closest("tr").find(".productPurchasePrice").val(),a=$(t).closest("tr").find(".productQnt").val(),o=$(t).closest("tr").find(".productPurchaseDiscount").val(),r=$(t).closest("tr").find(".subTotal");return a<1&&"Production"===$("#stockEntryType").val()?(alert("Negative quantity is not valid for Production of stock."),void $(t).closest("tr").find(".productQnt").val(1)):(""!==e&&null!==e&&"null"!==e||(e=0,$(t).closest("tr").find(".productPurchasePrice").val(0)),o.indexOf("%")>1&&o.replace("%","")>=100?($(t).closest("tr").find(".productPurchaseDiscount").val(0),void alert("Discount Must be below of 100%")):Number(o)>Number(e)&&o.indexOf("%")<1?($(t).closest("tr").find(".productPurchaseDiscount").val(0),void alert("Discount Must be below of product purchase price")):void $(r).html((BMS.FUNCTIONS.calculateDiscount(e,o)*a).toFixed(2)))},addProduct:function(t=""){var e=""===t?$("#selectProduct").val():t;""!==$("#stockTransferFromWarehouseId").val()?""!==e?this.getProductDetails(e,(t=>{void 0===t.error||!0!==t.error?(t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e="<input type='hidden' name='productBatch[]' value=''>";void 0!==t.hed&&"1"===t.hed&&(e=`<select name="productBatch[]" id="productBatch" class="form-control select2Ajax" select2-create-new-url="<?php echo full_website_address(); ?>/xhr/?tooltip=true&module=stock-management&page=newBatchForSelectedProduct&pid=${t.pid}" select2-ajax-url="<?php echo full_website_address(); ?>/info/?module=select2&page=batchList&pid=${t.pid}" required>\n <option value=""><?= __("Select Batch"); ?>....</option>\n </select>`);var a=t.iq?parseFloat(t.iq).toFixed(0):1,o=`<tr>\n <input type="hidden" name="productID[]" class="productID" value="${t.pid}">\n <td class="col-md-4">${t.pn}</td>\n <td class="col-md-2">${e}</td>\n <td class="col-md-1"><input onclick = "this.select()" type="text" name="productQnt[]" value="${a}" class="productQnt form-control text-center"></td>\n <td class="col-md-1"> ${t.pu}</td>\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productPurchasePrice[]" value="${t.pp}" class="productPurchasePrice form-control text-center" step="any"></td>\n <input type="hidden" name="productMainPurchasePrice[]" value="${t.pp}" step="any">\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productPurchaseDiscount[]" value="" placeholder="10% or 10" class="productPurchaseDiscount form-control text-center"></td>\n <td class="text-right subTotal">${parseFloat(t.pp*a).toFixed(2)}</td>\n <td style="width: 30px; !important">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(o)}))})),this.grandTotal(),$("#selectProduct").empty()):Swal.fire({title:"Error!",text:t.msg,icon:"error"})})):alert("Please select a product"):alert("Please select an warehouse to add product")}},BMS.RETURN={getProductReturnDetails:function({product_id:t,customer_id:e},a){$.ajax({url:full_website_address+"/info/?module=data&page=productDetailsForReturn&product_id="+t+"&customer_id="+e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e){a(t)}})},grandTotal:function(){var t=0;$(".productQnt").each((function(){t+=Number($(this).val())})),$("#totalItems").html($(".productQnt").length+"("+t+")");var e=0;$(".subTotal").each((function(){e+=Number($(this).html())})),$(".totalReturnPrice").html(e.toFixed(2));var a=BMS.FUNCTIONS.calculateDiscount(e,$("#returnDiscountValue").val());$(".totalReturnDiscount").html("(-) "+(e-a).toFixed(2));var o=0;$("#tariffCharges > .row").each((function(){var t=$(this).closest(".row").find(".tariffChargesName").val().split(": ")[1],e=BMS.FUNCTIONS.calculateTarifCharges(a,t);$(this).closest(".row").find(".tariffChargesAmount").val(e),o+=Number(e)})),$(".totalTariffCharges").html("(+) "+o.toFixed(2));var r=(Number(o)+Number(a)).toFixed(2);$(".netTotal").html(r),$("#returnNetTotal").val(r);var n=$("#returnShipping").val(),l=Number(r)+Number(n)-Number($("#returnSurcharge").val());$("#returnGrandTotal").val(l);var s=Number($("#returnPaidAmount").val()),i=l<=s?0:l-s,c=l>=s?0:s-l;$("#returnChangeAmount").val(c),$("#returnDueAmount").val(i)},calculateEachProduct:function(t){var e=$(t).closest("tr").find(".productReturnPrice").val(),a=$(t).closest("tr").find(".productQnt").val(),o=$(t).closest("tr").find(".productReturnDiscount").val(),r=$(t).closest("tr").find(".subTotal");if(a<1)return alert("Product quantity must be minimum of 1."),void $(t).closest("tr").find(".productQnt").val(1);""!==e&&null!==e&&"null"!==e||(e=0,$(t).closest("tr").find(".productReturnPrice").val(0)),o.indexOf("%")>1&&o.replace("%","")>=100?alert("Discount Must be below of 100%"):Number(o)>Number(e)&&o.indexOf("%")<1?alert("Discount Must be below of product return price"):$(r).html((BMS.FUNCTIONS.calculateDiscount(e,o)*a).toFixed(2))},addProduct:function(t=""){var e=""===t?$("#selectProduct").val():t,a=$("#returnCustomer").val();""!==a?""!==e?this.getProductReturnDetails({product_id:e,customer_id:a},(t=>{t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e=t.pd?t.pd:"0",a=parseFloat(BMS.FUNCTIONS.calculateDiscount(t.sp,e)).toFixed(2),o="<input type='hidden' name='productBatch[]' value=''>";void 0!==t.hed&&"1"===t.hed&&(o=`<select name="productBatch[]" id="productBatch" class="form-control select2Ajax" select2-ajax-url="<?php echo full_website_address(); ?>/info/?module=select2&page=batchList&pid=${t.pid}" required>\n <option value=""><?= __("Select Batch"); ?>....</option>\n </select>`);var r=`<tr>\n <input type="hidden" name="productID[]" class="productID" value="${t.pid}">\n <td class="col-md-4 productDetails">${t.pn}<br/>(<i>Purchased: ${t.prq} Returned: ${t.rtq}</i>)</td>\n <td class="col-md-2">${o}</td>\n <td class="col-md-1"><input onclick = "this.select()" type="text" name="productQnt[]" value="1" class="productQnt form-control text-center"></td>\n <td class="col-md-1">${t.pu}</td>\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productReturnPrice[]" value="${t.sp}" class="productReturnPrice form-control text-center" step="any"></td>\n <input type="hidden" name="productReturnMainPrice[]" value="${t.sp}" step="any">\n <td class="text-right col-md-1"><input onclick = "this.select()" type="text" name="productReturnDiscount[]" value="${e}" placeholder="10% or 10" class="productReturnDiscount form-control text-center"></td>\n <td class="text-right subTotal">${a}</td>\n <td style="width: 30px; !important">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(r)}))})),this.grandTotal(),$("#selectProduct").empty()})):alert("Please select a product"):alert("Please select the customer")},productUnitCheck:function(t){var e=t;this.getProductReturnDetails({product_id:$(t).closest("tr").find(".productID").val(),customer_id:$("#returnCustomer").val(),unit:$(t).val()},(t=>{var a=t[0];$(e).closest("tr").find(".productReturnPrice").val(parseFloat(a.sp).toFixed(2));var o=a.pn+"<br/>(<i>Purchased: "+parseFloat(a.prq).toFixed(2)+", Returned: "+parseFloat(a.rtq).toFixed(2)+")";$(e).closest("tr").find(".productDetails").html(o),this.calculateEachProduct(e),this.grandTotal()}))}},BMS.WASTAGE_SALE={grandTotal:function(){var t=0;$(".wastageSaleItemQnt").each((function(){t+=Number($(this).val())})),$("#totalItems").html($(".wastageSaleItemQnt").length+"("+t+")");var e=0;$(".wastageSaleItemSubtotal").each((function(){e+=Number($(this).text())})),$(".totalWastageSalePrice").html(e.toFixed(2));var a=BMS.FUNCTIONS.calculateDiscount(e,$("#wastageSaleDiscountValue").val());$(".totalWastageSaleDiscount").html("(-) "+(e-a).toFixed(2));var o=0;$("#tariffCharges > .row").each((function(){var t=$(this).closest(".row").find(".tariffChargesName").val().split(": ")[1],e=BMS.FUNCTIONS.calculateTarifCharges(a,t);$(this).closest(".row").find(".tariffChargesAmount").val(e),o+=Number(e)})),$(".totalTariffCharges").html("(+) "+o.toFixed(2));var r=(Number(o)+Number(a)).toFixed(2);$(".netTotal").html(r),$("#wastageSaleNetTotal").val(r);var n=$("#wastageSalePaidAmount").val(),l=n<r?r-n:0;$("#wastageSaleDue").val(l.toFixed(2))},addWastageSaleItem:function(){$("#productTable > tbody").append('<tr> <td class="col-md-5"> <input type="text" name="wastageSaleItem[]" placeholder="Enter Item name and details" class="wastageSaleItem form-control" required> </td> <td class="col-md-2"> <input type="number" step="any" name="wastageSaleItemQnt[]" class="wastageSaleItemQnt form-control" required> </td> <td class="col-md-2"> <input type="number" step="any" name="wastageSaleItemPrice[]" class="wastageSaleItemPrice form-control" required> </td> <td class="text-right wastageSaleItemSubtotal">0.00</td> <td style="width: 30px; !important"> <i style="cursor: pointer;" class="fa fa-trash-o removeThisItem"></i> </td> </tr>'),$(".wastageSaleItem").focus(),this.grandTotal()}},BMS.SPECIMEN_COPY={getProductDetails:BMS.POS.getProductDetails,disableEnableWarehouseSelect:function(){$(".productQnt").length>0?$("#scTransferWarehouse").prop("disabled",!0):$("#scTransferWarehouse").prop("disabled",!1)},addProduct:function(t=""){var e=""===t?$("#selectProduct").val():t,a=$("#scTransferWarehouse").val();""!==a?""!==e?this.getProductDetails({product_id:e,warehouse_id:a},(t=>{void 0===t.error||!0!==t.error?(t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e=t.iq?parseFloat(t.iq).toFixed(0):1,a=`<tr> <input type="hidden" name="productID[]" class="productID" value="${t.pid}">\n <td class="col-md-6">${t.pn}</td>\n <td class="col-md-3"><input onclick = "this.select()" type="text" name="productQnt[]" value="${e}" class="productQnt form-control text-center"></td>\n <td class="col-md-3">${t.pu}</td>\n <td style="width: 28px !important;">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(a)}))})),this.disableEnableWarehouseSelect(),$("#selectProduct").empty()):Swal.fire({title:"Error!",text:t.msg,icon:"error"})})):alert("Please select a product"):alert("Please select an warehouse to add product")},productUnitCheck:function(t){this.getProductDetails({product_id:$(t).closest("tr").find(".productID").val(),warehouse_id:$("#scTransferWarehouse").val(),qnt:$(t).closest("tr").find(".productQnt").val(),unit:$(t).val()},(e=>{void 0!==e.error&&!0===e.error&&($(t).closest("tr").find(".productQnt").val(e.stq),Swal.fire({title:"Error!",text:e.msg,icon:"error"}))}))},productQntCheck:function(t){var e=$(t).val();isNaN(e)&&(alert("Product quantity must be a valid number."),$(t).val(1),e=1),e<1&&(Swal.fire({title:"Error!",text:"Product qunatity must be at least one",icon:"error"}),$(t).val(1),e=1),this.getProductDetails({product_id:$(t).closest("tr").find(".productID").val(),warehouse_id:$("#scTransferWarehouse").val(),qnt:e,unit:$(t).closest("tr").find(".productItemUnit").val()},(e=>{void 0!==e.error&&!0===e.error&&($(t).val(e.stq),Swal.fire({title:"Error!",text:e.msg,icon:"error"}))}))}},BMS.SC_DISTRIBUTION={getProductDetails:BMS.PRODUCT.getDetails,addProduct:function(t=""){var e=""===t?$("#selectProduct").val():t;""!==e?this.getProductDetails(e,(t=>{void 0===t.error||!0!==t.error?(t.forEach((t=>{BMS.PRODUCT.validationCheck(t,this,(t=>{var e=t.iq?parseFloat(t.iq).toFixed(0):1,a=`<tr>\n <input type="hidden" name="productID[]" class="productID" value="${t.pid}">\n <td class="col-md-6">${t.pn}</td>\n <td class="col-md-3"><input onclick = "this.select()" type="text" name="productQnt[]" value="${e}" class="productQnt form-control text-center"></td>\n <td class="col-md-3">${t.pu}</td>\n <td style="width: 28px !important;">\n <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i>\n </td>\n </tr>`;$("#productTable > tbody").append(a)}))})),$("#selectProduct").empty()):Swal.fire({title:"Error!",text:t.msg,icon:"error"})})):alert("Please select a product")}};